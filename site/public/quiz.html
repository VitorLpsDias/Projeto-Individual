<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz </title>
  <link rel="icon" type="imagem/png" href="./assets/imagens/index/logoComNome.png" />
  <link rel="stylesheet" href="./css/quiz.css">

</head>

<body>
  <main class="container">
    <section class="container-conteudo">
      <h1>Spider-man</h1>
      <article class="center" id="instrucoes">
        <a href="./index.html" ><img class="logo" src="./assets/imagens/quiz/logoComNome.png"></a>
    </article>

      <article class="questoes">
        <header class="questao">
          <span id="numQuestao"></span>
          <h2 id="pergunta"></h2>
        </header>

        <div class="corpo">
          <ol type="A" id="alternativas">
            <li id="a" value="1A" class="respostas" onclick="verificarAcerto(this, this)"></li>
            <li id="b" value="1B" class="respostas" onclick="verificarAcerto(this, this)"></li>
            <li id="c" value="1C" class="respostas" onclick="verificarAcerto(this, this)"></li>
            <img id="myimg" src="https://cdn.sstatic.net/Sites/br/Img/apple-touch-icon.png?v=e57f45c9cfaf%22/%3E">

          </ol>
        </div>
      </article>

      <article id="aviso">Questão <span id="numero"></span>/<span id="total"></span></article>
    </section>
  </main>
</body>

</html>

<script>
  // Dados que serão alterados:
  // Let: definido apenas para esse escopo específico
  var instrucoes = document.querySelector('#instrucoes')
  // let titulo = document.querySelector('h1'); 
  var aviso = document.querySelector('#aviso');
  var pontos = 0;
  var placar = 0;

  var numQuestao = document.querySelector('#numQuestao'); //  "Seletor de consulta", Essa função só retorna o primeiro elemento encontrado que tem a mesma configuração do seletor passado como parâmetro.
  var pergunta = document.querySelector('#pergunta');

  // Alternativas da questão
  var a = document.querySelector('#a');
  var b = document.querySelector('#b');
  var c = document.querySelector('#c');


  var articleQuestoes = document.querySelector('.questoes');

  var alternativas = document.querySelector('#alternativas');

  var q0 = {
    numQuestao: 0,
    pergunta: "Pergunta",
    alternativaA: "Alternativa A",
    alternativaB: "Alternativa B",
    alternativaC: "Alternativa C",
    correta: "0",
  }

  var q1 = {
    numQuestao: 1,
    pergunta: "Qual é o nome verdadeiro do Homem-Aranha?",
    alternativaA: "Bruce Wayne",
    alternativaB: "Tony Stark",
    alternativaC: "Peter Parker",
    correta: "Peter Parker",
  }

  var q2 = {
    numQuestao: 2,
    pergunta: "Como Peter Parker adquiriu seus poderes de aranha?",
    alternativaA: "Mordido por uma aranha radioativa",
    alternativaB: "Resultado de um acidente científico",
    alternativaC: "Treinamento intensivo",
    correta: "Mordido por uma aranha radioativa",
  }




  var q3 = {
    numQuestao: 3,
    pergunta: "Quem se torna o vilão Venom?",
    alternativaA: "Flash Thompson",
    alternativaB: "Harry Osborn",
    alternativaC: "Eddie Brock",
    correta: "Eddie Brock",
  }



  var q4 = {
    numQuestao: 4,
    pergunta: "Quem é o principal vilão do Homem-Aranha?",
    alternativaA: "Duende Verde",
    alternativaB: "Doutor Octopus",
    alternativaC: "Homem-Areia",
    correta: "Duende Verde",
  }


  var q5 = {
    numQuestao: 5,
    pergunta: "Qual é o nome da tia de Peter Parker?",
    alternativaA: "Jane Parker",
    alternativaB: "May Parker",
    alternativaC: "Emily Parker",
    correta: "May Parker",
  }



  var q6 = {
    numQuestao: 6,
    pergunta: "Qual é o nome do jornal onde Peter Parker trabalha como fotógrafo?",
    alternativaA: "The Daily Bugle",
    alternativaB: "The Daily Planet",
    alternativaC: "The Daily News",
    correta: "The Daily Bugle",
  }



  var q7 = {
    numQuestao: 7,
    pergunta: "Qual é o famoso lema do Homem-Aranha?",
    alternativaA: "Com grandes poderes vêm grandes responsabilidades",
    alternativaB: "Eu sou o amigo da vizinhança",
    alternativaC: "Nenhum mal escapará da minha teia",
    correta: "Com grandes poderes vêm grandes responsabilidades",
  }



  var q8 = {
    numQuestao: 8,
    pergunta: "Qual é a cidade onde o Homem-Aranha geralmente atua?",
    alternativaA: "Los Angeles",
    alternativaB: "Gotham City",
    alternativaC: "Nova York",
    correta: "Nova York",
  }




  var q9 = {
    numQuestao: 9,
    pergunta: "Qual é o nome do filme lançado em 2002 que iniciou a trilogia dirigida por Sam Raimi?",
    alternativaA: "Homem-Aranha: De Volta ao Lar",
    alternativaB: "Homem-Aranha: Sem Volta para Casa",
    alternativaC: "Homem-Aranha",
    correta: "Homem-Aranha",
  }



  var q10 = {
    numQuestao: 10,
    pergunta: "Quem interpretou o Homem-Aranha no Universo Cinematográfico Marvel (MCU)?",
    alternativaA: "Tobey Maguire",
    alternativaB: "Andrew Garfield",
    alternativaC: "Tom Holland",
    correta: "Tom Holland",
  }


  // Criando uma lista contendo as questões
  var questoes = [q0, q1, q2, q3, q4, q5, q6, q7, q8, q9, q10];

  var numero = document.querySelector('#numero');
  var total = document.querySelector('#total');

  numero.textContent = q1.numQuestao; // TextContent representa o conteúdo de texto de um nó e dos seus descendentes, que será retornado para nós

  var totalDeQuestoes = (questoes.length) - 1;
  console.log('Total de questões ' + totalDeQuestoes);
  total.textContent = totalDeQuestoes;

  // Montando a primeira questão para início do quiz
  numQuestao.textContent = q1.numQuestao;
  pergunta.textContent = q1.pergunta;
  a.textContent = q1.alternativaA;
  b.textContent = q1.alternativaB;
  c.textContent = q1.alternativaC;


  a.setAttribute('value', '1A'); // Estou dando um atributo para a tag que contém ID "a"
  b.setAttribute('value', '1B');
  c.setAttribute('value', '1C');


  function proximaQuestao(nQuestao) {
    numero.textContent = nQuestao;
    numQuestao.textContent = questoes[nQuestao].numQuestao;
    pergunta.textContent = questoes[nQuestao].pergunta;
    a.textContent = questoes[nQuestao].alternativaA;
    b.textContent = questoes[nQuestao].alternativaB;
    c.textContent = questoes[nQuestao].alternativaC;


    a.setAttribute('value', nQuestao + 'A');
    b.setAttribute('value', nQuestao + 'B');
    c.setAttribute('value', nQuestao + 'C');

  }

  function bloquearAlternativas() {
    a.classList.add('bloqueado');
    b.classList.add('bloqueado');
    c.classList.add('bloqueado');

  }

  function bloquearAlternativas() {
    a.classList.remove('bloqueado');
    b.classList.remove('bloqueado');
    c.classList.remove('bloqueado');

  }

  function verificarAcerto(nQuestao, resposta) {
    var numeroDaQuestao = nQuestao.value;
    console.log(numeroDaQuestao);

    var respostaEscolhida = resposta.textContent;
    console.log(respostaEscolhida);

    var certa = questoes[numeroDaQuestao].correta;
    console.log(certa);

    if (respostaEscolhida == certa) {
      pontos += 10;
    } 

    // Atualizando placar
    placar = pontos;
    instrucoes.textContent = "Pontuação " + placar;

    // Bloquenado a escolha de opções
    bloquearAlternativas();

    setTimeout(function () {
      document.getElementById("myimg").src = 
      proxima = numeroDaQuestao + 1;
     
      // Verificando se estou no final das questões
      if (proxima > totalDeQuestoes) {
        fimDoJogo();
      } else {
        proximaQuestao(proxima);
      }
    }, 250);

    
  }

  function fimDoJogo() {
    var placarVar = placar;
    var idUsuarioVar = sessionStorage.ID_USUARIO;
    var usuario = sessionStorage.NOME_USUARIO;

    instrucoes.textContent = "Fim de Jogo!";
    numQuestao.textContent = "";

    var finalizado = "";
    if (placar >= 0 && placar < 10) {
      finalizado = `Total de ${pontos} pontos de ${usuario}. Abaixo de 10, hein! Mais sorte na próxima.`;
    } else if (placar <= 30) {
      finalizado = `Total de ${pontos} pontos de ${usuario}. Bom começo, mas dá para melhorar.`;
    } else if (placar <= 60) {
      finalizado = `Total de ${pontos} pontos de ${usuario}. Tava tãaaao próximo da média.`;
    } else if (placar <= 90) {
      finalizado = `Total de ${pontos} pontos de ${usuario}. Totalmente acima da média.`;
    } else if (placar < 100) {
      finalizado = `Total de ${pontos} pontos de ${usuario}. Foi quaaaase!`;
    }
    else {
      finalizado = `Total de ${pontos} pontos de ${usuario}. Gabaritou, lenda!`;
    }

    aviso.textContent = finalizado;

    a.textContent = ""
    b.textContent = ""
    c.textContent = ""
   

    a.setAttribute('value', '0');
    b.setAttribute('value', '0');
    c.setAttribute('value', '0');
    

    // Ocultando o article da questão
    articleQuestoes.style.display = 'none';

    if (placarVar == undefined && idUsuarioVar == undefined) {
      console.log("erro!")
    } else {
      fetch("/usuarios/obterPlacar", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          placarServer: placarVar,
          fkUsuarioServer: idUsuarioVar,
        })
      }).then(function (resposta) {

        console.log("resposta: ", resposta);

        if (resposta.ok) {
          console.log('Vitória! ' + pontos);

          setTimeout(function () {
            window.location.href = "ranking.html";
          }, 3500);
        } else {
          console.log('Erro ao enviar dados');
        }
      }).catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });

      return false;
    }
  }



  

</script>